## Artifactory HA installation guide for DC/OS

##### Architecture of Artifactory HA

![HA Artifactory Architecture](images/HA_Diagram.png)

## To set up Artifactory HA in DC/OS following are prerequisites:
1. **Database (MySQL, Oracle,  MS SQL and PostgreSQL)**
2. **Artifactory Pro Enterprise Value Pack**

## It requires min 1 public slave to install Artifactory Pro/Enterprise

## Steps to set up Artifactory HA:

1. Install MySQL in DC/OS.<br />
    [Here is guide to install MySQL in DC/OS](install-mysql.md)
    The database is used by all the nodes to store metadata attached to artifacts.<br />

2. Install artifactory-primary using DC/OS CLI.<br />
    1. create `artifactory-primary-options.json` with following content:
        ``` 
        {
          "service": {
            "name": "artifactory",
            "cpus": 2,
            "mem": 2048,
            "licenses": "$ARTIFACTORY_ENTERPRISE_LICENSES",
            "host-volume": "/var/artifactory",
            "database": {
              "connection-string": "jdbc:mysql://mysql.marathon.mesos:3306/artdb?characterEncoding=UTF-8&elideSetAutoCommits=true",
              "user": "jfrogdcos",
              "password": "jfrogdcos"
            }
          },
          "pro": {
            "local-volumes": {},
            "external-volumes": {
              "enabled": false
            }
          },
          "high-availability": {
            "enabled": true,
            "secondary": {
              "enabled": false,
              "unique-nodes": true,
              "nodes": 1,
              "name": "artifactory"
            }
          }
        }
        ```
        
       ###NOTE: Make sure database name, is correct in connection-string as well as username & password for database.
       ### Licenses: Provide all Artifactory licenses as a single string comma separated without white spaces in string.
       
    2. Install Artifactory-Primary using following command:
        `dcos package install --options=artifactory-primary-options.json artifactory`
    
    3. Make sure artifactory-primary is running and Healthy.
    
3. Install Artifactory-secondary:DC/OS CLI.<br />
   
   1. create `artifactory-secondary-options.json` with following content:
      ``` 
          {
            "service": {
              "name": "artifactory-secondary",
              "cpus": 2,
              "mem": 2048,
              "licenses": "$ARTIFACTORY_ENTERPRISE_LICENSES",
              "host-volume": "/var/artifactory",
              "database": {
                "connection-string": "jdbc:mysql://mysql.marathon.mesos:3306/artdb?characterEncoding=UTF-8&elideSetAutoCommits=true",
                "user": "jfrogdcos",
                "password": "jfrogdcos"
              }
            },
            "pro": {
              "local-volumes": {},
              "external-volumes": {
                "enabled": false
              }
            },
            "high-availability": {
              "enabled": true,
              "secondary": {
                "enabled": true,
                "unique-nodes": true,
                "nodes": 1,
                "name": "artifactory"
              }
            }
          }
      ```
       
   2. Install Artifactory-Primary using following command:
           `dcos package install --options=artifactory-secondary-options.json artifactory`
       
   3. Make sure artifactory-secondary is running and healthy.
   
   ### NOTE: API Key of Artifactory generated by Artifactory-Primary to fetch license from Artifactory-Primary (Optional)

## NOW you are just one step away from accessing Artifactory

4. [Install Artifactory-lb by following this guide](install-artifactory-lb.md)

5. Access Artifactory on public IP of DC/OS public slave. 

### Now try to access your DC/OS public slave load balancer you should be able to access Artifactory.

Here is how Artifactory UI looks like!!!
![Artifactory UI](images/Artifactory_UI.png)

## To use JFrog Artifactory please visit wiki.jfrog.com
## To learn more about DC/OS go to the [official DC/OS website](https://dcos.io/)
